# Разработка API для сервиса Otium


## Задача
Поставить задачу разработчикам на реализацию новой функции в стриминговом сервисе Otium.


## Процесс работы

### Анализ интервью с заказчиком
Проведен анализ представленного [интервью с заказчиком](https://docs.google.com/document/d/1jOs8d4xdM9XxqxA_s9kOXqO93d2hr9Rf/edit?usp=drive_link&ouid=110366814820056538789&rtpof=true&sd=true), чтобы выяснить требования. Из интервью выделено следующее:

*   **Рейтинг от кинокритиков:**
    *   Отображение рейтинга, предоставленного кинокритиками, для каждого фильма и сериала (где доступно).
    *   Использование рейтинга кинокритиков как «экспертной оценки» для помощи пользователям в выборе контента.
    *   Добавление рейтинга кинокритиков в описание каждого фильма и сериала.

*   **Сортировка по рейтингу:**
    *   Возможность сортировки списков фильмов и сериалов по рейтингу (по возрастанию и убыванию).
    *   Поддержка сортировки как по рейтингу кинокритиков, так и по пользовательскому рейтингу.
    *   Применение сортировки после фильтрации (например, по жанру).

*   **Обработка контента без рейтинга:**
    *   Сохранение фильмов и сериалов без рейтинга кинокритиков в результатах поиска.
    *   Отображение контента без рейтинга в конце списка при сортировке по рейтингу (независимо от направления сортировки).

**Дополнительно:**

*   Рейтинг кинокритиков добавляется как атрибут сущности «фильм или сериал», без необходимости создания новой базы данных.

### Диаграмма последовательности

Сделана диаграмма последовательности, иллюстрирующая процесс фильтрации и последующей сортировки списка фильмов и сериалов.

![Обновленная диаграмма UML](https://github.com/prJulia1980/Projects/blob/main/%D0%9F%D1%80%20%E2%84%964_%D0%94%D0%B8%D0%B0%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B0%20%D0%BF%D0%BE%D1%81%D0%BB%D0%B5%D0%B4%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE%D1%81%D1%82%D0%B8_Otium.png)
<p align="center">Рис 1. UML Sequence Diagram</p>


На основе диаграммы последовательности определены API в Swagger, необходимые для доработки, чтобы обеспечить отображение рейтинга кинокритиков и сортировку контента. Сформулирована задача для backend-разработчика.

## Задача на разработку

#### Цель 

Дать пользователям возможность удобнее выбирать фильмы и сериалы для просмотра, опираясь на оценки других зрителей и профессиональных критиков.

#### Требование

Пользователь должен иметь возможность сортировать списки фильмов и сериалов как по рейтингу зрителей, так и по рейтингу кинокритиков, в порядке возрастания и убывания.

#### Use Case 

1.  В разделе «Библиотека» пользователь видит список фильмов и сериалов.
2.  Пользователь в интерфейсе выбирает параметры, по которым он хочет отфильтровать список фильмов и сериалов, и/или режим сортировки.
3.  Система возвращает список фильмов и сериалов, отфильтрованный и отсортированный согласно указанным данным.

#### Описание изменений 

1.  Необходимо доработать для Films Server API.
    *  В ответ `{{FilmsServer}}/films/list` добавить новое поле `criticsRating`.
    *   В ответ `{{FilmsServer}}/films` добавить новое поле `criticsRating`.

2.  Необходимо доработать для Series Server API.
    *   В ответ `{{SeriesServer}}/series/list` добавить новое поле `criticsRating`.
    *   В ответ `{{SeriesServer}}/series` добавить новое поле `criticsRating`.

3.  Необходимо доработать для Web Server API.
    *   В запрос `{{WebServer}}/content/list` добавить два query-параметра: `sortBy` и `direction`.
    *   В ответ `{{WebServer}}/content/list` добавить новое поле `criticsRating`.
    *   В ответ `{{WebServer}}/content/details` добавить новое поле `criticsRating`.

#### Контекст 

В ответе запроса `{{FilmsServer}}/films/list` и `{{SeriesServer}}/series/list` уже есть рейтинг зрителей `rating`, по которому также нужно будет выполнять сортировку.

## Операции Films Server API

#### 1.1. В ответ `{{FilmsServer}}/films/list` в объект с детальным описанием каждого фильма необходимо добавить новое опциональное поле `criticsRating`. Поле должно заполняться данными о рейтинге кинокритиков.

**Тип метода:** GET

**URL запроса:** `/films/list`

**Параметры запроса:** -

**Пример запроса:** `https://2ee4902e-6893-4bf2-9b6f-88b9f5fcb78a.mock.pstmn.io/films/list`

**Элементы тела запроса:** -

**Пример ответа:**

```json
[
   {
       "id": 101,
       "type": "film",
       "title": "Хосэ Каньон",
       "description": "Хосэ Каньон — добрый и открытый парень — устроился в офис электриком и рассказывает коллегам историю своей необыкновенной жизни.",
       "imageUrl": "https://otium.imagestorage.ru/JoseCanyon.img",
       "previewUrl": "https://otium.previewstorage.ru/JoseCanyon.mov",
       "recordUrl": "https://otium.recordstorage.ru/JoseCanyon.mov",
       "genre": [
           "comedy"
       ],
       "recommended": true,
       "details": {
           "yearOfIssue": "1995",
           "duration": 152,
           "country": [
               "США"
           ],
           "ageRate": "16+"
       },
       "rating": 9.4,
       "criticsRating": 7.4
   }
]
```


| Элементы ответа | Тип    | Обязательность | Описание                                                              |Ошибки
|-----------------|--------|-----------------|---------------------------------------------------------------------|-----------------|
| `criticsRating` | `number` | Необязателен   | Рейтинг кинокритиков, возможные значения от 0 до 10.               |Изменения не требуются | 


#### 1.2. В ответ {{FilmsServer}}/​​films в объект с детальным описанием фильма необходимо добавить новое опциональное поле criticsRating. Поле должно заполняться данными о рейтинге кинокритиков.

**Тип метода:** GET

**URL запроса:** `/films`

**Параметры запроса:** Изменения не требуются

**Пример запроса:** `https://2ee4902e-6893-4bf2-9b6f-88b9f5fcb78a.mock.pstmn.io/films?id=101`

**Элементы тела запроса:** -

**Пример ответа:**

```json
{
  "id": 101,
  "type": "film",
  "title": "Хосэ Каньон",
  "description": "Хосэ Каньон — добрый и открытый парень — устроился в офис электриком и рассказывает коллегам историю своей необыкновенной жизни.",
  "imageUrl": "https://otium.imagestorage.ru/JoseCanyon.img",
  "previewUrl": "https://otium.previewstorage.ru/JoseCanyon.mov",
  "recordUrl": "https://otium.recordstorage.ru/JoseCanyon.mov",
  "genre": [
    "comedy"
  ],
  "recommended": true,
  "details": {
    "yearOfIssue": "1995",
    "duration": 152,
    "country": [
      "США"
    ],
    "ageRate": "16+"
  },
  "language": {
    "original": [
      "английский"
    ],
    "sound": [
      "русский",
      "английский"
    ],
    "subtitle": [
      "русский",
      "английский"
    ]
  },
  "team": {
    "cast": [
      "Джон Джэксон",
      "Джулия Блэйк"
    ],
    "dubbingTeam": [
      "Дэвид Браун"
    ]
  },
  "rating": 9.4,
  "criticsRating": 7.4
}
```

| Элементы ответа | Тип    | Обязательность | Описание                                                              |Ошибки
|-----------------|--------|-----------------|---------------------------------------------------------------------|-----------------|
| `criticsRating` | `number` | Необязателен   | Рейтинг кинокритиков, возможные значения от 0 до 10.               |Изменения не требуются | 

## Операции Series Server API

#### 2.1. В ответ {{SeriesServer}}/​​series/list необходимо добавить новое опциональное поле criticsRating (рейтинг кинокритиков).
**Тип метода:** GET

**URL запроса:** `/series/list`

**Параметры запроса:** -

**Пример запроса:** `https://2ee4902e-6893-4bf2-9b6f-88b9f5fcb78a.mock.pstmn.io/series/list`

**Элементы тела запроса:** -

**Пример ответа:**

```json
[
  {
    "id": 205,
    "type": "series",
    "title":  "Индийский океан и я",
    "description":  "Погрузитесь в веселые приключения на берегу Индийского океана, где дети вместе с местными животными учатся ценить природу и дружбу.",
    "imageUrl": "https://otium.imagestorage.ru/IndianOcean&I.img",
    "previewUrl": "https://otium.previewstorage.ru/MysteryOfEldorado.mov",
    "recordUrl": "https://otium.recordstorage.ru/IndianOcean&I.mov",
    "genre": [
      "kids"
    ],
    "recommended": true,
    "rating": 9.4,
    "criticsRating": 8.0
  }
]
```

| Элементы ответа | Тип    | Обязательность | Описание                                                              |Ошибки
|-----------------|--------|-----------------|---------------------------------------------------------------------|-----------------|
| `criticsRating` | `number` | Необязателен   | Рейтинг кинокритиков, возможные значения от 0 до 10.               |Изменения не требуются | 

#### 2.2. В ответ {{SeriesServer}}/​​series необходимо добавить новое опциональное поле criticsRating.

**Тип метода:** GET

**URL запроса:** `/series`

**Параметры запроса:** -

**Пример запроса:** `https://2ee4902e-6893-4bf2-9b6f-88b9f5fcb78a.mock.pstmn.io/series?id=205`

**Элементы тела запроса:** -

**Пример ответа:**

```json
{
  "id": 205,
  "type": "series",
  "title": "Загадка города Эльдорадо",
  "description": "Географа подозревают в написании книги, которую он не писал. Герой знакомится с журналисткой мексиканской газеты Глорией, вместе они пытаются раскрыть тайну мифиечкого города.",
  "imageUrl": "https://otium.imagestorage.ru/MysteryOfEldorado.img",
  "previewUrl": "https://otium.previewstorage.ru/MysteryOfEldorado.mov",
  "recordUrl": "https://otium.recordstorage.ru/MysteryOfEldorado.mov",
  "genre": [
    "action"
  ],
  "recommended": true,
  "details": {
    "yearOfIssue": "2007",
    "episodesCount": 12,
    "country": [
      "Великобритания, Турция, США"
    ],
    "ageRate": "12+"
  },
  "language": {
    "original": [
      "английский, турецкий"
    ],
    "sound": [
      "русский, английский"
    ],
    "subtitle": [
      "русский, английский, турецкий"
    ]
  },
  "rating": 6.5,
  "criticsRating": 7.4
}

```
| Элементы ответа | Тип    | Обязательность | Описание                                                              |Ошибки
|-----------------|--------|-----------------|---------------------------------------------------------------------|-----------------|
| `criticsRating` | `number` | Необязателен   | Рейтинг кинокритиков, возможные значения от 0 до 10.               |Изменения не требуются | 

## Операции Web Server API

#### 3.1. В запрос `{{WebServer}}/content/list` добавить два query-параметра: `sortBy` и `direction`.

Поле `sortBy` может принимать два значения:

*   Если `"sortBy": "rating"`, внутри массива сортировка элементов должна выполняться по полю `rating`.
*   Если `"sortBy": "criticsRating"`, сортировка должна выполняться по полю `criticsRating`.

Если у элемента списка поле `rating` или `criticsRating` пустое/отсутствует, то такой элемент нужно выводить в конце списка.

Поле `direction` может принимать два значения:

*   Если `"direction": "desc"`, внутри массива элементы должны сортироваться по параметру `sortBy` по убыванию.
*   Если `"direction": "asc"`, внутри массива элементы должны сортироваться по параметру `sortBy` по возрастанию.

**Тип метода:** GET

**URL запроса:** `/content/list`

**Параметры запроса, которые нужно добавить:**

*   **`sortBy`**: (Query Parameter)
    *   Тип: `string`
    *   Обязательность: Необязателен
    *   Описание: Параметр сортировки.
        *   Варианты значений: `rating`, `criticsRating`
*   **`direction`**: (Query Parameter)
    *   Тип: `string`
    *   Обязательность: Необязателен
    *   Описание: Направление сортировки.
        *   Варианты значений: `desc`, `asc`

**Пример запроса:** `https://2ee4902e-6893-4bf2-9b6f-88b9f5fcb78a.mock.pstmn.io/content/list?sortBy=criticsRating&direction=asc`

**Элементы тела запроса:** -

**Пример ответа:**

```json
[
  {
    "id": 201,
    "type": "serie",
    "title": "Индийский океан и я",
    "description": "Погрузитесь в веселые приключения на берегу Индийского океана, где дети вместе с местными животными учатся ценить природу и дружбу.",
    "imageUrl": "https://otium.imagestorage.ru/IndianOcean&I.img",
    "previewUrl": "https://otium.previewstorage.ru/IndianOcean&I.mov",
    "recordUrl": "https://otium.recordstorage.ru/IndianOcean&I.mov",
    "genre": [
      "kids"
    ],
    "recommended": false,
    "details": {
      "year Of Issue": "2015",
      "episodesCount": 4,
      "country": [
        "Индонезия"
      ],
      "ageRate": "6+"
    },
    "rating": 7.5,
    "criticsRating": 7.4
  },
  {
    "id": 101,
    "type": "film",
    "title": "Хосе Каньон",
    "description": "Хосе Каньон — добрый и открытый парень — устроился в офис электриком и рассказывает коллегам историю своей необыкновенной жизни.",
    "imageUrl": "https://otium.imagestorage.ru/JoseCanyon.img",
    "previewUrl": "https://otium.previewstorage.ru/JoseCanyon.mov",
    "recordUrl": "https://otium.recordstorage.ru/JoseCanyon.mov",
    "genre": [
      "comedy"
    ],
    "recommended": true,
    "details": {
      "yearOfIssue": "1995",
      "duration": 152,
      "country": [
        "США"
      ],
      "ageRate": "16+"
    },
    "rating": 9.4,
    "criticsRating": 8.5
  }
]

```
| Элементы ответа | Тип    | Обязательность | Описание                                                              |Ошибки
|-----------------|--------|-----------------|---------------------------------------------------------------------|-----------------|
| `criticsRating` | `number` | Необязателен   | Рейтинг кинокритиков, возможные значения от 0 до 10.               |Изменения не требуются | 

#### 3.2. В ответ {{WebServer}}/​​content/list добавить новое поле criticsRating. 

**Тип метода:** GET

**URL запроса:** `/content/list`

**Параметры запроса:** -

**Пример запроса:** -

**Элементы тела запроса:** -

**Пример ответа:**

```json
[
  {
    "id": 104,
    "type": "film",
    "title": "Ребус Атлантиды",
    "description": "Археолога подозревают в преступлении, которого он не совершал. Герой знакомится с историком турецкой полиции Шехер Джан, вместе они пытаются раскрыть тайну.",
    "imageUrl": "https://otium.imagestorage.ru/RebusOfAtlantis.img",
    "previewUrl": "https://otium.previewstorage.ru/RebusOfAtlantis.mov",
    "recordUrl": "https://otium.recordstorage.ru/RebusOfAtlantis.mov",
    "genre": [
      "thriller, mystery"
    ],
    "recommended": true,
    "details": {
      "yearOfIssue": "2007",
      "duration": 159,
      "country": [
        "Великобритания, Турция, США"
      ],
      "ageRate": "12+"
    },
    "language": {
      "original": [
        "английский, турецкий"
      ],
      "sound": [
        "русский, английский"
      ],
      "subtitle": [
        "русский, английский, турецкий"
      ]
    },
    "team": {
      "cast": [
        "Джон Джэксон, Айше Болат"
      ],
      "dubbingTeam": [
        null
      ]
    },
    "rating": 6.5,
    "criticsRating": 7.4
  }
]
```
| Элементы ответа | Тип    | Обязательность | Описание                                                              |Ошибки
|-----------------|--------|-----------------|---------------------------------------------------------------------|-----------------|
| `criticsRating` | `number` | Необязателен   | Рейтинг кинокритиков, возможные значения от 0 до 10.               |Изменения не требуются | 

#### 3.3. В ответ {{WebServer}}/content/details добавить новое поле criticsRating.

**Тип метода:** GET

**URL запроса:** `/content/details`

**Параметры запроса:** -

**Пример запроса:** `https://2ee4902e-6893-4bf2-9b6f-88b9f5fcb78a.mock.pstmn.io/content/details?type=film&id=104`

**Элементы тела запроса:** -

**Пример ответа:**

```json
[
  {
    "id": "104",
    "type": "film",
    "title": "Ребус Атлантиды",
    "description": "Археолога подозревают в преступлении, которого он не совершал. Герой знакомится с историком турецкой полиции Шехер Джан, вместе они пытаются раскрыть тайну.",
    "imageUrl": "https://otium.imagestorage.ru/RebusOfAtlantis.img",
    "previewUrl": "https://otium.previewstorage.ru/RebusOfAtlantis.mov",
    "recordUrl": "https://otium.recordstorage.ru/RebusOfAtlantis.mov",
    "genre": [
      "thriller, mystery"
    ],
    "recommended": true,
    "details": {
      "yearOfIssue": "2007",
      "duration": 159,
      "country": [
        "Великобритания, Турция, США"
      ],
      "ageRate": "12+"
    },
    "language": {
      "original": [
        "английский, турецкий"
      ],
      "sound": [
        "русский, английский"
      ],
      "subtitle": [
        "русский, английский, турецкий"
      ]
    },
    "team": {
      "cast": [
        "Джон Джэксон, Айше Болат"
      ],
      "dubbingTeam": [
        null
      ]
    },
    "rating": 6.5,
    "criticsRating": 7.4
  }
]
```
| Элементы ответа | Тип    | Обязательность | Описание                                                              |Ошибки
|-----------------|--------|-----------------|---------------------------------------------------------------------|-----------------|
| `criticsRating` | `number` | Необязателен   | Рейтинг кинокритиков, возможные значения от 0 до 10.               |Изменения не требуются | 

